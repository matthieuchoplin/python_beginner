<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Session 11</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">
		<!-- Custom css -->
        <link rel="stylesheet" href="css/custom.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link rel="stylesheet" href="css/font-awesome.min.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Introduction to programming using Python</h2>
					<h3>Session 11</h3>
                    <p>Matthieu Choplin</p>
                    <p><a href='http://mattchoplin.com/'>http://mattchoplin.com/</a></p>
				</section>

				<section>
					<h3>Objectives</h3>
					<ul>
                        <li>SQL usage and syntax</li>
					</ul>
				</section>

                <section>
                    <h3>Definition</h3>
                    <p>SQL (Structured Query Language) is a language for managing data held in a relational database management system (RDBMS).</p>
                </section>

                <section>
                    <h3>Tools</h3>
                    <p>SQLite is an example of an RDMS</p>
                    <p>We are going to use a SQLite client, install it from <a href="http://sqlitebrowser.org/">http://sqlitebrowser.org/</a></p>
                    <p>Download the database file <a href="exercises/example_db">example_db</a> and open it with SQLite browser</p>
                </section>

                <section>
                    <h3>Operations we can do in SQLite browser</h3>
                    <p>Open the SQLite browser and do the following:</p>
                    <ul>
                        <li>Creating a database</li>
                        <li>Creating a table</li>
                        <li>Creating fields for our table</li>
                        <li>Adding records to the table</li>
                    </ul>
                </section>

                <section>
                    <h3>Joining table</h3>
                    <p>You can link records of different tables using a "foreign key"</p>
                    <p>A foreign key is a field in one table that uniquely identifies a row of another table or the same table.</p>
                    <img src="imgs/db_relationship.png" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>Creating a table in SQL</h3>
                    <pre><code>CREATE TABLE `person` (
	`id`	INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
	`name`	TEXT NOT NULL,
	`age`	INTEGER,
	`address_id`	INTEGER,
	FOREIGN KEY(`address_id`) REFERENCES `address`(`id`) on delete set null
);</code></pre>
                    <p>You can see the SQL generated by SQLite browser under the table creation window</p>
                </section>

                <section>
                    <h3>Creating data</h3>
                    <p>You can do it directly through the GUI (graphical user interface) in the tab "Browse Data", then "New Record"</p>
                    <p>The equivalent in SQL is:</p>
                    <pre><code>INSERT INTO example
 (field1, field2, field3)
 VALUES
 ('test', 'N', NULL);</code></pre>
                    <p>Example:</p>
                    <pre><code>INSERT INTO address
 (street, street_number, city)
 VALUES
 ('Linden Gardens', '77', 'London');</code></pre>
                </section>

                <section>
                    <h3>Exercise: create a new person record</h3>
                    <p>In the SQLite browser tool, navigate to the tab "Execute SQL" and create a new person record using an SQL query only.</p>
                </section>

                <section>
                    <h3>Reading data</h3>
                    <p>SELECT syntax:</p>
                    <pre><code>SELECT column1, column2, ...
FROM table_name;</code></pre>
                </section>

                <section>
                    <h3>Exercise: select all the persons' name</h3>
                    <p>In the SQLite browser tool, navigate to the tab "Execute SQL" and write a query to select all the persons' name.</p>
                </section>

                <section>
                    <h3>Filter the result with the WHERE clause</h3>
                    <p>Syntax:</p>
                    <pre><code>SELECT column1, column2, ...
FROM table_name
WHERE condition;</code></pre>
                    <p>Example:</p>
                    <pre><code>SELECT * from address where city != 'London';</code></pre>
                    <p>Note: the * means "all" or "everything", so above we select all the fields of the table</p>
                </section>

                <section>
                    <h3>Operators</h3>
                    <table style="line-height: 100%; font-size: 20px;">
<tr>
<th>Operator</th>
<th>Description</th>
<th>Example</th>
</tr>
<tr>
<td><code>=</code></td>
<td>Equal to</td>
<td>Author='Alcott'</td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td>Not equal to (many DBMSs accept <code>!=</code> in addition to <code>&lt;&gt;</code>)</td>
<td>Dept&lt;&gt;'Sales'</td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>Greater than</td>
<td>Hire_Date&gt;'2012-01-31'</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>Less than</td>
<td>Bonus&lt; 50000.00</td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>Greater than or equal</td>
<td>Dependents&gt;= 2</td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>Less than or equal</td>
<td>Rate&lt;= 0.05</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>Between an inclusive range</td>
<td>Cost BETWEEN 100.00AND 500.00</td>
</tr>
<tr>
<td>LIKE</td>
<td>Match a character pattern</td>
<td>First_Name LIKE 'Will%'</td>
</tr>
<tr>
<td>IN</td>
<td>Equal to one of multiple possible values</td>
<td>DeptCode IN (101, 103, 209)</td>
</tr>
<tr>
<td>IS <i>or</i> ISNOT</td>
<td>Compare to null (missing data)</td>
<td>Address ISNOTNULL</td>
</tr>
<tr>
<td>ISNOTDISTINCTFROM</td>
<td>Is equal to value or both are nulls (missing data)</td>
<td>Debt ISNOTDISTINCTFROM-Receivables</td>
</tr>
<tr>
<td>AS</td>
<td>Used to change a field name when viewing results</td>
<td>SELECT employee AS 'department1'</td>
</tr>
</table>
                </section>

                <section>
                    <h3>Updating data</h3>
                    <p>You can modify existing records</p>
                    <p>Syntax:</p>
                    <pre><code>UPDATE table_name
SET column1 = value1, column2 = value2, ...
WHERE condition;</code></pre>
                    <p>Example:</p>
                    <pre><code>UPDATE person
SET age = 24
WHERE name='Matt';</code></pre>
                </section>

                <section>
                    <h3>Exercise: increment the age of every person</h3>
                    <p>Using an UPDATE statement, increment by 1 the age of every person in the database</p>
                </section>

                <section>
                    <h3>Deleting data</h3>
                    <p>You can delete all or specific records of a table.</p>
                    <p>Syntax:</p>
                    <pre><code>DELETE FROM table_name
WHERE condition;</code></pre>
                    <p>Example:</p>
                    <pre><code>DELETE FROM person
WHERE name='Matt';</code></pre>
                </section>

                <section>
                    <h3>Exercise: delete the address with the street field starting with "L"</h3>
                    <p>Hint: use the "WHERE" and "LIKE" keyword</p>
                </section>

                <section>
                    <h3>More powerful SELECT using the join keyword</h3>
                    <p>When the records of the tables are related with a foreign key, we can retrieve them at the same time by "joining" them</p>
                    <img src="imgs/db_relationship.png" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>Join Syntax and Example</h3>
                    <p>Syntax:</p>
                    <pre><code>select *
from table1
join other_table2
on table1.foreign_key_to_other_table2=other_table2.id;</code></pre>
                    <p>Example:</p>
                    <pre><code>select *
from person
join address on person.address_id=address.id
where name='Matt';</code></pre>
                </section>

                <section>
                    <h3>Different types of join</h3>
                    <ul>
                        <li>(INNER) JOIN: Returns records that have matching values in both tables</li>
                    </ul>
                    <img src="imgs/img_innerjoin.gif" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>Different types of join</h3>
                    <ul>
                        <li>LEFT (OUTER) JOIN: Return all records from the left table, and the matched records from the right table</li>
                    </ul>
                    <img src="imgs/img_leftjoin.gif" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>Different types of join</h3>
                    <ul>
                        <li>RIGHT (OUTER) JOIN: Return all records from the right table, and the matched records from the left table</li>
                    </ul>
                    <img src="imgs/img_rightjoin.gif" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>Different types of join</h3>
                    <ul>
                        <li>FULL (OUTER) JOIN: Return all records when there is a match in either left or right table</li>
                    </ul>
                    <img src="imgs/img_fulljoin.gif" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 280px"/>
                </section>

                <section>
                    <h3>SQL and python (1)</h3>
                    <p>Connecting the dots...</p>
                    <p>Selecting data</p>
                    <pre><code>import sqlite3

connection = sqlite3.connect("example_db")
cursor = connection.cursor()
cursor.execute("select * from person")
print(cursor.fetchall())</code></pre>
                    <p>I assume here that the example_db is at the same directory level as the python script</p>
                </section>

                <section>
                    <h3>SQL and Python (2)</h3>
                    <pre><code>import sqlite3

name, age = 'John', 21
with sqlite3.connect("example_db") as connection:
    cursor = connection.cursor()
    cursor.execute(
        "INSERT INTO person VALUES"
        "(?, ?, ?, ?)", (3, name, age, False))
    cursor.execute("SELECT * FROM person")
    rows = cursor.fetchall()
    print(rows)</code></pre>
                </section>

			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				slideNumber: true,
				center: false,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/menu/menu.js' },
					{ src: 'plugin/jquery-2.0.0.min.js' },
					{ src: 'plugin/custom.js' },

				]
			});
		</script>
	</body>
</html>
